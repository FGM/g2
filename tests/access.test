<?php
/**
 * Test suite for the G2 glossary module
 *
 * @author Frederic G. MARAND
 * @copyright Ouest Systemes Informatiques (OSI)
 * @license CeCILL 2.0
 *
 * License note: G2 is distributed by OSI to its customers
 * under the CeCILL 2.0 license. OSI support services only
 * apply to the module when distributed by OSI, not by any
 * third-party further down the distribution chain.
 *
 * If you obtained G2 from drupal.org, that site received it under the
 * GPLv2 license and can therefore distribute it under the GPLv2, and so
 * can you and just anyone down the chain as long as the GPLv2 terms are
 * abided by, the module distributor in that case being the drupal.org
 * organization or the downstream distributor, not OSI.
 *
 */

class G2AccessTest extends DrupalWebTestCase {
  public static function getInfo() {
    $ret = array(
      'name'  => t('G2 tests'),
      'description'  => t('Make sure that G2 paths are adequately protected'),
      'group' => t('G2 module tests'),
    );
    return $ret;
  }

  public function setUp() {
    parent::setUp('taxonomy', 'g2');
  }

  /**
   * Make sure only appropriate users have access to the settings page
   */
  public function testAdminSettingsAccess() {
    $account = $this->drupalCreateUser(array('access content'));
    $this->drupalLogin($account);
    $this->drupalGet(G2PATHSETTINGS);
    $this->assertResponse(403, t('Access to settings denied to normal users'));
    $this->drupalLogout();

    $account = $this->drupalCreateUser(array(G2PERMVIEW));
    $this->drupalLogin($account);
    $this->drupalGet(G2PATHSETTINGS);
    $this->assertResponse(403, t('Access to settings denied to users with G2 limited perms'));
    $this->drupalLogout();

    $account = $this->drupalCreateUser(array('administer site configuration'));
    $this->drupalLogin($account);
    $this->drupalGet(G2PATHSETTINGS);
    $this->assertResponse(200, t('Access to settings granted to G2 admins'));
    $this->drupalLogout();
    }
  }